{% extends 'base.html.twig' %}

{% form_theme form _self %}



{% block _command_collection_entry_widget %}

    <div class="col-lg-12 align-items-center">
        <h6>Cliquez ici pour compléter votre achat:</h6>
            <p>
                <a class="btn btn-info" data-toggle="collapse" href="#collapseticket_{{ form.vars.id }}" role="button" aria-expanded="true" aria-controls="collapseticket">
                Aficher/Masquer ce billet
                </a>
            </p>
            <div class="collapse show" id="collapseticket_{{ form.vars.id }}">
                <div class="card card-body">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            {{ form_row(form['VisitorName']) }}
                        </div>
                        <div class="form-group col-md-6">
                            {{ form_row(form['VisitorSurName']) }}
                        </div>
                        <div class="form-group col-8">
                            {{ form_row(form['VisitorCountry']) }}
                        </div>
                        <div class="form-group col-sm-6">
                            {{ form_row(form['VisitorDoB']) }}
                        </div>
                        <div class="form-group col-md-6" data-toggle="popover" data-placement="right" data-trigger="focus" title="Votre attention:" data-content="Vous ne pouvez pas commander pour une date passée, un dimanche ou un jour férié.">
                            {{ form_row(form['DesiredDate']) }}
                        </div>
                        <div class="form-group col-md-6" data-toggle="popover" data-placement="right" data-trigger="focus" title="Votre attention:" data-content="Si vous visitez aujourd'hui, la journée entière n'est plus disponible passé 14h.">
                            {{ form_row(form['DayType']) }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-check">
                            {{ form_row(form['ReducedPrice']) }}
                        </div>
                    </div>
                    
                        </div>
                    </div>
                </div>
            </div>
    </div>

{% endblock %}



{% block body %}
{{ form_start(form) }}
    <h5>Vous pouvez commander plusieurs billets à l'aide du bouton "Ajouter un billet".</h5> 
        <div class="col-lg-12">
            <div class="ticketsOrdered" id="ticket_list" data-prototype="{{ form_widget(form.ticketsOrdered.vars.prototype)|e('html_attr')}}">
                {% for tickets in form.ticketsOrdered %}        
                    {{ form_widget (form) }}       
                {% endfor %}
            </div>
        </div>
 {{ form_end(form) }}
<div class="row justify-content-md-center">
    <a href="/" class="btn btn-dark" id="back-first-page" role="button">Retour à l'accueil</a>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
<script>
$(function () {
  $('[data-toggle="popover"]').popover()
});
$(function () {
  $('.popover-dismiss').popover({
    trigger: 'focus'
  })
});
</script>

<script>

var $collectionHolder;

// setup an "add a tag" link
var $addTagButton = $('<button type="button" class="btn btn-info">Ajouter un billet</button>');
var $newLinkLi = $('<div class="col-lg-6"></div>').append($addTagButton);





jQuery(document).ready(function() {
    // Get the ul that holds the collection of tags
    $collectionHolder = $('.ticketsOrdered');
    // add the "add a tag" anchor and li to the tags ul
    $collectionHolder.append($newLinkLi);



    // count the current form inputs we have (e.g. 2), use that as the new
    // index when inserting a new item (e.g. 2)
    $collectionHolder.data('index', $collectionHolder.find(':input').length);

    $addTagButton.on('click', function(e) {
        // add a new tag form (see next code block)
        addNewForm($collectionHolder, $newLinkLi);
    });

    $collectionHolder.find('div').each(function(){
        addDeleteLink($(this));
    })
});

//add 
function addNewForm($collectionHolder, $newLinkLi) {
    // Get the data-prototype explained earlier
    var prototype = $collectionHolder.data('prototype');

    // get the new index
    var index = $collectionHolder.data('index');

    var newForm = prototype;
    // You need this only if you didn't set 'label' => false in your tags field in TaskType
    // Replace '__name__label__' in the prototype's HTML to
    // instead be a number based on how many items we have
    // newForm = newForm.replace(/__name__label__/g, index);

    // Replace '__name__' in the prototype's HTML to
    // instead be a number based on how many items we have
    newForm = newForm.replace(/__name__/g, index);

    // increase the index with one for the next item
    $collectionHolder.data('index', index + 1);

    // Display the form in the page in an li, before the "Add a tag" link li
    var $newFormLi = $('<div></div>').append(newForm);
    $newLinkLi.before($newFormLi);

    //add delete link
    addDeleteForm($newFormLi);
}

function addDeleteForm($form){
    var $addDeleteButton = $('<div class="col-lg-6"><p><button type="button" class="btn btn-danger">Supprimer ce billet</button></p></div>');
    $form.append($addDeleteButton);

    $addDeleteButton.on('click',function(e){
        $form.remove();
    })
}


        

</script>


{% endblock %}